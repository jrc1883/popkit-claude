---
description: "report | search | share [--issue, --share]"
---

# /popkit:bug - Bug Reporter

Report issues the agent encountered with automatic context capture, local logging, optional GitHub issue creation, and pattern sharing.

## Usage

```
/popkit:bug <description> [flags]
```

## Flags

| Flag | Description |
|------|-------------|
| `--issue` | Create GitHub issue with captured context |
| `--share` | Anonymize and share pattern to collective (Pro/Team) |
| `--verbose` | Include full tool outputs in report |
| `--no-context` | Skip automatic context capture |

## Subcommands

| Subcommand | Description |
|------------|-------------|
| (default) | Report a bug with description |
| `list` | List locally logged bugs |
| `view <id>` | View a specific bug report |
| `clear` | Clear local bug logs |

---

## Default: Report Bug

```
/popkit:bug "Agent got stuck on OAuth flow"
/popkit:bug "TypeScript type error with generics" --issue
/popkit:bug "Build failing after upgrade" --share --issue
```

### Process

1. **Capture Context** - Automatically gather:
   - Recent tool calls (last 10)
   - Files touched in session
   - Error messages from output
   - Agent state (progress, current task)
   - Project context (language, framework)
   - Git status (branch, uncommitted changes)

2. **Generate Report** - Format bug report with:
   - User description
   - Captured context
   - Error analysis
   - Suggested next steps

3. **Output** - Based on flags:
   - Default: Log to `.claude/bugs/`
   - `--issue`: Create GitHub issue
   - `--share`: Upload anonymized pattern

### Context Capture

The following context is automatically captured:

| Context | Description |
|---------|-------------|
| Recent Tools | Last 10 tool calls with inputs/outputs |
| Files Touched | Files read, edited, or created |
| Error Messages | Errors detected in tool outputs |
| Agent Progress | Current task and completion percentage |
| Project Type | Language, framework, services detected |
| Git Status | Branch, uncommitted changes, recent commits |

### Example Output

```
Bug Report
==========
ID: bug-2024-12-04-001
Time: 2024-12-04T10:30:00Z

Description: Agent got stuck on OAuth flow

Context:
  Language: TypeScript
  Framework: Next.js
  Branch: feature/oauth
  Uncommitted: 3 files

Recent Actions:
  1. Edit src/auth/oauth.ts
  2. Bash: npm run build (failed)
  3. Edit src/auth/oauth.ts (same file, 2nd time)
  4. Read src/auth/types.ts
  5. Edit src/auth/oauth.ts (same file, 3rd time)

Error Detected:
  TypeError: Cannot read property 'token' of undefined
  at handleTokenRefresh (oauth.ts:45)

Analysis:
  - Same file edited 3+ times (stuck pattern)
  - Build command failed
  - Error suggests null/undefined issue

Logged to: .claude/bugs/bug-2024-12-04-001.json
```

---

## Subcommand: list

List all locally logged bug reports.

```
/popkit:bug list
/popkit:bug list --limit 5
/popkit:bug list --since 2024-12-01
```

### Output

```
Bug Reports (.claude/bugs/)
===========================

ID                    | Date       | Description
----------------------|------------|---------------------------
bug-2024-12-04-001    | 2024-12-04 | Agent got stuck on OAuth flow
bug-2024-12-03-002    | 2024-12-03 | TypeScript type error
bug-2024-12-03-001    | 2024-12-03 | Build failing after upgrade

Total: 3 bugs logged
```

---

## Subcommand: view

View details of a specific bug report.

```
/popkit:bug view bug-2024-12-04-001
/popkit:bug view bug-2024-12-04-001 --raw    # Show JSON
```

---

## Subcommand: clear

Clear local bug logs.

```
/popkit:bug clear                    # Clear all
/popkit:bug clear --before 2024-12-01   # Clear old
/popkit:bug clear bug-2024-12-04-001    # Clear specific
```

---

## GitHub Issue Generation

When `--issue` flag is used, creates a formatted GitHub issue:

```markdown
## Bug Report (Auto-Generated)

**Description:** Agent got stuck on OAuth flow

**Context:**
- Language: TypeScript
- Framework: Next.js
- Branch: feature/oauth
- Current Task: Implement OAuth

**Recent Actions:**
1. Edit src/auth/oauth.ts
2. Bash: npm run build (failed)
3. Edit src/auth/oauth.ts (same file, 2nd time)
4. Read src/auth/types.ts
5. Edit src/auth/oauth.ts (same file, 3rd time)

**Error Output:**
TypeError: Cannot read property 'token' of undefined

**Agent Progress:** 30% â†’ stuck

**Stuck Patterns Detected:**
- Same file edited 3+ times
- Build command failed

---
*Generated by PopKit Bug Reporter*
```

---

## Pattern Sharing (Pro/Team)

When `--share` flag is used, the bug pattern is anonymized and shared to the collective learning database.

### Anonymization Process

| Before | After |
|--------|-------|
| `/Users/joe/myapp/src/auth/oauth.ts` | `auth module` |
| `handleTokenRefresh()` | `token refresh handler` |
| API keys, secrets | `[REDACTED]` |
| Variable names | Generic terms |

### What Gets Shared

- Error type and pattern
- Language and framework context
- Abstract solution approach
- Success/failure outcome

### What Never Gets Shared

- Absolute file paths
- Function/variable names
- API keys or secrets
- Project-specific details
- Personal information

---

## Tiered Features

| Feature | Free | Pro | Team |
|---------|------|-----|------|
| Local logging | Yes | Yes | Yes |
| GitHub issue creation | Yes | Yes | Yes |
| Context capture | Basic | Full | Full |
| Pattern sharing | No | Yes | Yes |
| Bug analytics | No | Yes | Yes |

---

## Examples

```bash
# Basic bug report (logged locally)
/popkit:bug "Agent can't find the right file"

# Create GitHub issue with context
/popkit:bug "Tests failing after refactor" --issue

# Share pattern to collective (Pro/Team)
/popkit:bug "OAuth token refresh failing" --share

# Full report with issue and sharing
/popkit:bug "Memory leak in production" --issue --share --verbose

# List recent bugs
/popkit:bug list

# View specific bug
/popkit:bug view bug-2024-12-04-001
```

---

## Architecture Integration

| Component | Integration |
|-----------|-------------|
| Context Capture | `hooks/utils/bug_context.py` |
| Local Storage | `.claude/bugs/*.json` |
| Pattern Sharing | `power-mode/insight_embedder.py` |
| GitHub Issues | `gh issue create` |

## Related Commands

| Command | Purpose |
|---------|---------|
| `/popkit:debug` | Systematic debugging and root cause analysis |
| `/popkit:issue create` | Create GitHub issues manually |
| `/popkit:next` | Context-aware next action recommendations |
