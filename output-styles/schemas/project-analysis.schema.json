{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Project Analysis Output",
  "description": "Schema for structured project analysis output consumed by generators",
  "strict": true,
  "type": "object",
  "required": [
    "project_name",
    "project_type",
    "analyzed_at",
    "frameworks",
    "patterns",
    "commands",
    "quality_metrics"
  ],
  "properties": {
    "project_name": {
      "type": "string",
      "description": "Name of the project (from directory name or package.json)"
    },
    "project_type": {
      "type": "string",
      "description": "Primary project type (next.js, express, fastapi, etc.)"
    },
    "analyzed_at": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of analysis"
    },
    "frameworks": {
      "type": "array",
      "description": "Detected frameworks and libraries",
      "items": {
        "type": "object",
        "required": ["name", "confidence"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Framework or library name"
          },
          "version": {
            "type": "string",
            "description": "Detected version if available"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Detection confidence (0.0-1.0)"
          }
        }
      }
    },
    "patterns": {
      "type": "array",
      "description": "Detected code patterns",
      "items": {
        "type": "object",
        "required": ["name", "category", "confidence"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Pattern identifier (e.g., feature-based-organization)"
          },
          "category": {
            "type": "string",
            "enum": ["architecture", "api", "state", "naming", "testing", "framework"],
            "description": "Pattern category"
          },
          "confidence": {
            "type": "number",
            "minimum": 0,
            "maximum": 1,
            "description": "Detection confidence (0.0-1.0)"
          },
          "examples": {
            "type": "array",
            "items": { "type": "string" },
            "description": "File paths demonstrating the pattern"
          },
          "description": {
            "type": "string",
            "description": "Human-readable pattern description"
          }
        }
      }
    },
    "recommended_skills": {
      "type": "array",
      "description": "Skills that would benefit this project",
      "items": {
        "type": "object",
        "required": ["name", "reason", "priority"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Skill name to generate"
          },
          "reason": {
            "type": "string",
            "description": "Why this skill would help"
          },
          "priority": {
            "type": "string",
            "enum": ["high", "medium", "low"],
            "description": "Priority level"
          }
        }
      }
    },
    "recommended_agents": {
      "type": "array",
      "description": "Agents that would be valuable for this project",
      "items": {
        "type": "object",
        "required": ["name", "reason"],
        "properties": {
          "name": {
            "type": "string",
            "description": "Agent name"
          },
          "reason": {
            "type": "string",
            "description": "Why this agent would help"
          }
        }
      }
    },
    "commands": {
      "type": "object",
      "description": "Detected project commands",
      "properties": {
        "dev": {
          "type": "string",
          "description": "Development server command"
        },
        "build": {
          "type": "string",
          "description": "Build command"
        },
        "test": {
          "type": "string",
          "description": "Test command"
        },
        "lint": {
          "type": "string",
          "description": "Lint command"
        },
        "typecheck": {
          "type": "string",
          "description": "Type checking command"
        }
      }
    },
    "quality_metrics": {
      "type": "object",
      "description": "Code quality indicators",
      "properties": {
        "typescript_strict": {
          "type": "boolean",
          "description": "Whether TypeScript strict mode is enabled"
        },
        "test_coverage_estimate": {
          "type": "string",
          "description": "Estimated test coverage percentage"
        },
        "linting_configured": {
          "type": "boolean",
          "description": "Whether linting is configured"
        },
        "formatting_configured": {
          "type": "boolean",
          "description": "Whether code formatting is configured"
        },
        "ci_configured": {
          "type": "boolean",
          "description": "Whether CI/CD is configured"
        }
      }
    },
    "directory_structure": {
      "type": "object",
      "description": "Key directories in the project",
      "properties": {
        "source": {
          "type": "string",
          "description": "Main source directory (src/, app/, lib/)"
        },
        "tests": {
          "type": "string",
          "description": "Test directory"
        },
        "config": {
          "type": "string",
          "description": "Configuration directory"
        },
        "docs": {
          "type": "string",
          "description": "Documentation directory"
        }
      }
    },
    "dependencies": {
      "type": "object",
      "description": "Dependency information",
      "properties": {
        "production_count": {
          "type": "integer",
          "description": "Number of production dependencies"
        },
        "dev_count": {
          "type": "integer",
          "description": "Number of dev dependencies"
        },
        "key_dependencies": {
          "type": "array",
          "items": { "type": "string" },
          "description": "Most important dependencies"
        }
      }
    }
  },
  "additionalProperties": false,
  "examples": [
    {
      "project_name": "my-nextjs-app",
      "project_type": "next.js",
      "analyzed_at": "2025-01-15T10:30:00Z",
      "frameworks": [
        {"name": "Next.js", "version": "14.0.0", "confidence": 0.95},
        {"name": "React", "version": "18.2.0", "confidence": 0.95},
        {"name": "Tailwind CSS", "version": "3.4.0", "confidence": 0.9}
      ],
      "patterns": [
        {
          "name": "feature-based-organization",
          "category": "architecture",
          "confidence": 0.85,
          "examples": ["src/features/auth", "src/features/dashboard"],
          "description": "Feature-based organization grouping related code by domain"
        },
        {
          "name": "react-query",
          "category": "state",
          "confidence": 0.9,
          "examples": ["src/hooks/useUser.ts", "src/hooks/useProducts.ts"],
          "description": "React Query for server state management"
        }
      ],
      "recommended_skills": [
        {"name": "project:deploy", "reason": "Detected Next.js + Vercel", "priority": "high"},
        {"name": "project:db-migrate", "reason": "Detected Prisma", "priority": "medium"}
      ],
      "recommended_agents": [
        {"name": "performance-optimizer", "reason": "Large component tree detected"},
        {"name": "accessibility-guardian", "reason": "UI-heavy application"}
      ],
      "commands": {
        "dev": "npm run dev",
        "build": "npm run build",
        "test": "npm test",
        "lint": "npm run lint",
        "typecheck": "npx tsc --noEmit"
      },
      "quality_metrics": {
        "typescript_strict": true,
        "test_coverage_estimate": "65%",
        "linting_configured": true,
        "formatting_configured": true,
        "ci_configured": true
      }
    }
  ]
}
